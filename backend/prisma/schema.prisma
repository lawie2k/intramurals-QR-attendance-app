datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Student {
  id            Int           @id @default(autoincrement())
  firstName     String        @db.VarChar(128)
  lastName      String        @db.VarChar(128)
  email         String        @unique @db.VarChar(191)
  studentId     String        @unique @db.VarChar(64)
  department    String?       @db.VarChar(128)
  passwordHash  String        @db.VarChar(191)
  qrToken       String        @default(uuid()) @unique @db.VarChar(191)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  faceTemplates FaceTemplate[]
  attendances   Attendance[]
}

model FaceTemplate {
  id            Int      @id @default(autoincrement())
  studentId     Int
  embedding     Json
  imageUrl      String   @db.VarChar(255)
  model         String   @db.VarChar(64)
  embeddingDim  Int
  createdAt     DateTime @default(now())
  student       Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@index([studentId])
}

model Attendance {
  id           Int      @id @default(autoincrement())
  studentId    Int
  eventId      Int
  qrToken      String   @db.VarChar(191)
  faceVerified Boolean  @default(false)
  faceScore    Float?
  verifyMethod String?
  timestamp    DateTime @default(now())
  student      Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@index([studentId])
  @@index([eventId])
  @@index([qrToken])
}

model Event {
  id        Int      @id @default(autoincrement())
  name      String   @db.VarChar(128)
  createdAt DateTime @default(now())
}
